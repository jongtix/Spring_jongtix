<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="QnaBoardDAO">

	<resultMap type="qnaBoard" id="boardResult">
		<id property="num" column="NUM" />
		<result property="flag" column="FLAG" />
		<result property="writer" column="WRITER" />
		<result property="subject" column="SUBJECT" />
		<result property="content" column="CONTENT" />
		<result property="email" column="EMAIL" />
		<result property="readcount" column="READCOUNT" />
		<result property="password" column="PASSWORD" />
		<result property="ref" column="REF" />
		<result property="re_step" column="RE_STEP" />
		<result property="re_level" column="re_level" />
		<result property="ip" column="IP" />
		<result property="regDate" column="REGDATE" />
	</resultMap>

	<!-- 새글 등록 -->
	<insert id="insertQnaBoard" parameterType="qnaBoard">
	<![CDATA[
		insert into
		pj_QnAboard(num, flag, writer, subject, content, email,
		readcount,
		password, ref, re_step, re_level, ip, reg_date)
		values((select
		nvl(max(num), 0) + 1 from pj_qnaboard), #{flag}, #{writer},
		#{subject}, #{content}, #{email},
		0, #{password}, #{ref}, #{re_step},
		#{re_level}, #{ip}, sysdate)	
	]]>
	</insert>

	<!-- Q&A 게시판 글 수 -->
	<select id="getQnaBoardTotal" resultType="int">
		select count(*) from
		pj_QnAboard where flag like '1%'
	</select>

	<!-- FAQ 게시판 글 수 -->
	<select id="getFaqBoardTotal" resultType="int">
		select count(*) from
		pj_QnAboard where (flag like '11') or (flag like '1%'
		and readcount >
		20)
	</select>

	<!-- Q&A 게시판 글 목록 -->
	<select id="selectQnaBoardList" parameterType="Map">
		select * from
		(select rownum rn, a.* from (select * from pj_QnAboard where
		flag like
		'1%' order by ref desc, re_step) a) where rn between ? and ?
	</select>

	<!-- 상세 조회 -->
	<select id="selectOne" parameterType="int" resultType="board">
		select *
		from boardvo where seq=#{seq}
	</select>

	<!-- update 처리 -->
	<update id="updateBoard" parameterType="board">
		update boardvo
		set
		writer=#{writer},title=#{title},content=#{content},files=#{files}
		where seq=#{seq}
	</update>

	<delete id="deleteBoard" parameterType="int">
		delete from boardvo where
		seq=#{seq}
	</delete>

	<update id="updateCount" parameterType="int">
		update boardvo set cnt =
		nvl(cnt,0)+1 where seq=#{seq}
	</update>
</mapper>
